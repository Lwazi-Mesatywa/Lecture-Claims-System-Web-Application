@model Lecture_Claims_System_Web_Application.Models.ClaimViewModel

<h2>Submit New Claim</h2>

<!-- Progress Bar -->
<div id="progress-container" style="width: 100%; background-color: #f3f3f3; margin-bottom: 20px;">
    <div id="progress-bar" style="width: 0%; height: 20px; background-color: #4caf50;"></div>
</div>

<form asp-action="SubmitClaim" asp-controller="Claims" method="post" enctype="multipart/form-data">
    <div>
        <label>Hours Worked:</label>
        <input asp-for="HoursWorked" type="number" step="0.01" />
        <span asp-validation-for="HoursWorked"></span>
    </div>

    <div>
        <label>Hourly Rate:</label>
        <input asp-for="HourlyRate" type="number" step="0.01" />
        <span asp-validation-for="HourlyRate"></span>
    </div>

    <div>
        <label>Total Amount Owed:</label>
        <input type="text" id="total-amount" readonly style="background-color: #f0f0f0;" />
    </div>

    <div>
        <label>Notes:</label>
        <textarea asp-for="Notes"></textarea>
    </div>

    <div>
        <label>Attach a File:</label>
        <input asp-for="FileAttachment" type="file" />
    </div>

    <button type="submit">Submit Claim</button>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const fields = document.querySelectorAll(".progress-field");
            const progressBar = document.getElementById("progress-bar");
            const totalFields = fields.length;

            function updateProgressBar() {
                let filledFields = 0;

                fields.forEach(field => {
                    if (field.value.trim() !== "") {
                        filledFields++;
                    }
                });

                // Calculate progress percentage
                const percentage = (filledFields / totalFields) * 100;
                progressBar.style.width = percentage + "%";
            }

            // Attach input event listener to fields
            fields.forEach(field => {
                field.addEventListener("input", updateProgressBar);
            });

            // Trigger update on page load to account for pre-filled fields
            updateProgressBar();
        });
        $(document).ready(function () {
            function calculateTotal() {
                // Get the values of hours worked and hourly rate
                const hoursWorked = parseFloat($("#hours-worked").val()) || 0; // Default to 0 if empty or invalid
                const hourlyRate = parseFloat($("#hourly-rate").val()) || 0;   // Default to 0 if empty or invalid

                // Calculate total amount owed
                const totalAmount = hoursWorked * hourlyRate;

                // Display the total in the Total Amount field
                $("#total-amount").val(totalAmount.toFixed(2)); // Format to 2 decimal places
            }

            // Attach change event listeners to calculation fields
            $(".calculation-field").on("input", function () {
                calculateTotal();
            });
        });
    </script>
}
